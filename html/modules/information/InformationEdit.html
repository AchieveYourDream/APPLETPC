<script type="text/javascript">
       if(sessionStorage.getItem('securityContext')==null){
         window.location.href="../../../login.html";
        }
        var securityContext = JSON.parse(sessionStorage.getItem('securityContext'));

        var path = sessionStorage.getItem('path');
        var redPath = sessionStorage.getItem('redPath');
        var information_id = sessionStorage.getItem('information_id');
</script>
<!DOCTYPE html>
<html>
<head>
	<title>新建零售定价</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/css/common/common.css">
    <link type="text/css" rel="stylesheet" href="/APPLETPC/js/bootstrap/css/bootstrap.css">
	<script type="text/javascript"src="/APPLETPC/js/jquery/jquery-2.2.3.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/common/common.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/common/util.js"></script>
    <script type="text/javascript" src="/APPLETPC/js/json/json2.js"></script>
    <script type="text/javascript" src="/APPLETPC/js/bootstrap/js/bootstrap.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/json/model/AppInformation.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/jquery-validate/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/jquery-validate/jquery.validate.plu.js"></script>
	<link rel="stylesheet" href="/APPLETPC/js/plugins/jquery-chosen/css/chosen.css" type="text/css"></link>
	<script type="text/javascript" src="/APPLETPC/js/plugins/jquery-chosen/js/chosen.jquery.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/layer/layer.js"></script>
	<script type="text/javascript" src="../../../js/plugins/city-ganged/date.js"></script>
	
	<style>
.item {
	width: 200px;
	height: 200px;
	position: relative;
	left:120px;
}

.addImg {
	width: 200px;
	height: 200px;
	position: absolute;
	left: 55px;
	top: 0;
	z-index: 2;
	cursor: pointer;
}

.preview,.preBlock {
	position: absolute;
	display: none;
	width: 200px;
	height: 200px;
	left: 28px;
	top: 0;
}

.delete {
	width: 20px;
	position: absolute;
	right: -55px;
	top: 0px;
	cursor: pointer;
	display: none;
}

.preBlock img {
	display: block;
	width: 200px;
	height: 200px;
}

.upload_input {
	display: block;
	width: 0;
	height: 0;
	-webkit-opacity: 0.0;
	/* Netscape and Older than Firefox 0.9 */
	-moz-opacity: 0.0;
	/* Safari 1.x (pre WebKit!) 老式khtml内核的Safari浏览器*/
	-khtml-opacity: 0.0;
	/* IE9 + etc...modern browsers */
	opacity: .0;
	/* IE 4-9 */
	filter: alpha(opacity = 0);
	/*This works in IE 8 & 9 too*/
	-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
	/*IE4-IE9*/
	filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0 );
}
</style>	
</head>
<body class="my-body-content">
<form id="InformationEditForm" name="InformationEditForm" class="my-form-content">
<input type="hidden" id="information_id" name="information_id">
			<div style="width:90%">
			 <div class="item">
		        <img class="addImg" onclick="clickImg(this);" src="/APPLETPC/js/plugins/app-imgupload/img/addImg.png" />
		        <input name="url" type="file" class="upload_input" onchange="change(this)"/>
		        <div class="preBlock">
		            <img class="preview" id="preview" alt="" name="pic" width="190" height="190" />
		        </div>
		        <img class="delete" onclick="deleteImg(this)" src="/APPLETPC/js/plugins/app-imgupload/img/delete.png"/>
		    </div>
		    </div>
				<table class="my-form-table-content">
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;" >标题</label>
						</td>	
						<td class="my-form-table-td-content" style="width:420px">
							<input  id="title" name="title" type="text"   class="form-control input-sm"  style="width:400px;padding:5px;float:left;"    >
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;" >内容</label>
						</td>	
						<td class="my-form-table-td-content" >
							<input  id="content" name="content" type="text"   class="form-control input-sm"  style="width:400px;padding:5px;float:left;"    >
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;">是否发布</label>
						</td>
						<td class="my-form-table-td-content">
							<select id="isvisible" name="isvisible" class="dept_select dimension_coding"  style="width:400px;padding:5px;float:left;" >
							 <option value="Y">是</option>
							 <option value="N">否</option>
							</select> 
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;" >详情URL</label>
						</td>	
						<td class="my-form-table-td-content">
							<input  id="detail_url" name="detail_url" type="text"   class="form-control input-sm"  style="width:400px;padding:5px;float:left;"    >
						</td>
					</tr>
					
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;">是否banner显示</label>
						</td>
						<td class="my-form-table-td-content">
							<select id="is_banner_show" name="is_banner_show" class="dept_select dimension_coding"  style="width:400px;padding:5px;float:left;" >
							 <option value="Y">是</option>
							 <option value="N">否</option>
							</select> 
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;" >显示顺序</label>
						</td>	
						<td class="my-form-table-td-content">
							<input  id="show_order" name="show_order" type="text"   class="form-control input-sm"  style="width:400px;padding:5px;float:left;"    >
						</td>
					</tr>
				</table>
				
			</form>
</body>
</html>
<script type="text/javascript">
var validator;
$(document).ready(function() {
$("#is_banner_show").chosen({disable_search:true,width:"400px"});
$("#isvisible").chosen({disable_search:true,width:"400px"});

validator = $("#InformationEditForm").validate({
		debug: true,
		showErrors: showErrors,
		rules: {
			title: {
				required: true,
				maxlength: 30,
			},
			content:{
				maxlength: 50,
			},
			detail_url:{
				maxlength: 100,
			},
			show_order:{
				maxlength: 3,
				number:true
			}
		},
		messages: {
			title: {
				required: "标题不能为空！",
				maxlength: "标题最大长度为30！",
			},
			content: {
				maxlength: "最大长度为50！"
			},
			detail_url:{
				maxlength: "最大长度为100！"
			},
			show_order:{
				maxlength: "最大长度为3！",
				number: "请输入数字！"
			}
		}
	
	});
	
	
	var url = path+"api/appInformation/selectAppInformationByPk";
	url += "?t=" + new Date();
	
	$.ajax({
		type: "POST",
		url: url,
		async:false,
		data:{"token":securityContext.token,"information_id":information_id},
		success: function(data) {
		
		if (data.result_code == "Y") {
		debugger;
			var ai = JSON.parse(data.result_info);
// 			  预览
	      var pic = $(".preview");
// 	 	       添加按钮
	      var addImg = $(".addImg");
// 	   	      删除按钮
	      var deleteImg = $(".delete");
	       
	       pic.attr("src",redPath+"getRedImages/information/"+ai.show_pic);
	       addImg.hide();
	       deleteImg.show();
		   pic.show();
		   pic.parent().show();
		   dwr.util.setValues(ai);
		    $("#is_banner_show").trigger("chosen:updated")
		     $("#isvisible").trigger("chosen:updated")
		} else if (data.result_code == "N") {
			$.growl.error({    title: "错误标题", message: data.result_info});
		}
		}
	});
	
});

  
 //资讯编辑
function doEditInformation() {
	var result = false;
	if (validator.form()) {
		var ac = new AppInformation();
		dwr.util.getValues(ac);
		var url = path+"api/appInformation/updateAppInformation";
		url += "?t=" + new Date();
		url+="&token="+securityContext.token;
		$.ajax({
			type: "POST",
		    url: url,
		    data: ac,
		    async: false,
		    success: function(data){
				if (data.result_code == "Y") {
					result = true;
				} else if (data.result_code == "N") {
					result = false;
					$.growl.warning({    title: "错误标题", message: data.result_info});
				}
		    }
		});
		}
	return result;
} 

//上传图片
function  uploadImage(){
			
		var url = redPath+"appInformation/updateInformationImage/information";
		url += "?t=" + new Date();
		url+="&token="+securityContext.token;
		url+="&information_id="+information_id;

        var pic = new FormData();
        if($(".upload_input")[0].files[0]==null){
        $.growl.error({    title: "错误标题", message: "请选择图片"});
        return false;
        }
        if($(".upload_input")[0].files[0].size>300000){
        $.growl.error({    title: "错误标题", message: "图片不符合规范,为保证访问速度请图片大小在300K以下"});
        return false;
        }
   		 pic.append("pic", $(".upload_input")[0].files[0]);
        $.ajax({
            url: url,
            type: 'POST',
            cache: false,
            data: pic,
            processData: false,
            contentType: false,
            async: false,
            success: function (data) {
            	
				if (data.code == "S") {
					$.growl.notice({    title: "错误标题", message: "修改成功"});
				} else  {
					result = false;
				$.growl.error({    title: "错误标题", message: data.info});
				}
            }
        });
}
 
 //点击
  var clickImg = function(obj){
    $(obj).parent().find('.upload_input').click();
  }
  //删除
  var deleteImg = function(obj){
    $(obj).parent().find('input').val('');
    $(obj).parent().find('img.preview').attr("src","");
    $(obj).parent().find('img.preview').hide();
    //IE9以下
    $(obj).parent().find('img.preview').css("filter","");
    $(obj).hide();
    $(obj).parent().find('.addImg').show();
  }
  //选择图片
  function change(file) {
      //预览
      var pic = $(file).parent().find(".preview");
      //添加按钮
      var addImg = $(file).parent().find(".addImg");
      //删除按钮
      var deleteImg = $(file).parent().find(".delete");

      var ext=file.value.substring(file.value.lastIndexOf(".")+1).toLowerCase();
 	
       // gif在IE浏览器暂时无法显示
       if(ext!='png'&&ext!='jpg'&&ext!='jpeg'){
          if (ext != '') {
            alert("图片的格式必须为png或者jpg或者jpeg格式！"); 
          } 
           return;
       }
          html5Reader(file,pic,addImg,deleteImg);
          uploadImage();
  }
 //H5渲染
  function html5Reader(file,pic,addImg,deleteImg){
     var file = file.files[0];
     var reader = new FileReader();
     reader.readAsDataURL(file);
     reader.onload = function(e){
         pic.attr("src",this.result);
     }
     addImg.hide();
     deleteImg.show();
     pic.show();
     pic.parent().show();
    
  }  
</script>