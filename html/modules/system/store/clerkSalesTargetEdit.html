<script type="text/javascript">
         if(sessionStorage.getItem('securityContext')==null){
         window.location.href="/APPLETPC/login.html";
        }
        var securityContext = JSON.parse(sessionStorage.getItem('securityContext'));

        var path = sessionStorage.getItem('path');
        var clerk_id = sessionStorage.getItem('clerk_id');
        var store_code = sessionStorage.getItem('store_code');
</script>
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

	<title>量体师销售目标编辑</title>

	<link   type="text/css" rel="stylesheet" href="/APPLETPC/css/common/common.css">
    <link   type="text/css" rel="stylesheet" href="/APPLETPC/js/bootstrap/css/bootstrap.css">
	<script type="text/javascript" src="/APPLETPC/js/common/common.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/common/util.js"></script>
	<script type="text/javascript"src="/APPLETPC/js/jquery/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="/APPLETPC/js/json/json2.js"></script>
    <script type="text/javascript" src="/APPLETPC/js/bootstrap/js/bootstrap.js"></script>
	 <link type="text/css" rel="stylesheet"
		href="/APPLETPC/js/plugins/bootstrap-datetime/css/bootstrap-datetimepicker.min.css">
		
	<script type="text/javascript"
		src="/APPLETPC/js/plugins/bootstrap-datetime/js/bootstrap-datetimepicker.min.js"></script>
		
	<script type="text/javascript"
		src="/APPLETPC/js/plugins/bootstrap-datetime/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
	<script type="text/javascript" src="/SPMTMWEB/js/plugins/jquery-growl/js/jquery.growl.js"></script>
	<link rel="stylesheet" href="/SPMTMWEB/js/plugins/jquery-growl/css/jquery.growl.css" type="text/css"></link>
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-table/css/bootstrap-table.css">
<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/js/bootstrap-table-500.js"></script>
<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/local/bootstrap-table-zh-CN.js"></script>
<script type="text/javascript" src="/APPLETPC/js/json/model/StoClerkTarget.js"></script>
	
<style>
#setting>div{
display: inline-block;
}

</style>
</head>
<body class="my-body-content">
<div id="setting">
			<div>
				<span >日期:</span>
			</div>
	        <div>
				<input class="input-sm form_date  form-control" type="text"  data-date-format="yyyy-mm" id="month_date" name="month_date" readonly>
			</div>
			
			<div>
				<span >销售目标:</span>
			</div>
			<div>
				<input id="sell_target" class="form-control input-sm"  "type="text" onkeyup="this.value=this.value.replace(/[^0-9-]+/,'');" maxlength="7"style="width:130px;"/>
			</div>
			<div>
				<button type="button" class="btn btn-success" onclick="updateStoClerk()"><i class="glyphicon glyphicon-retweet" ></i>设置</button>
			</div>
</div>
	<table id="SalesTargetTableInfo"  
		class="table table-condensed "
			data-toggle="table" 
		    data-undefined-text=""
            data-icon-size="sm"
            data-pagination="true"
            data-page-size="10"
            data-page-list="[10,15,20,25,30]"
            data-striped="true"
		    >
			<thead >
				<tr >
					<th data-halign="center"  	 data-align="center" data-formatter="indexNuber" >序号</th>
					<th data-field="clerk_id" 	 data-halign="center" data-align="center" >量体师证号</th>
					<th data-field="attribute1"	 data-halign="center" data-align="center"   >量体师名称</th>
					<th data-field="month_date"	 data-halign="center" data-align="center"   >月份</th>
					<th data-field="sell_target"	 data-halign="center" data-align="center"   >销售目标</th>
					<th data-field="create_date" data-halign="center" data-align="center" data-events="operateEvents" data-formatter="operateFormatter">操作</th>
					
				</tr>
			</thead>
		</table>
</body>
</html>

<script type="text/javascript">
$(document).ready(function() {
$(".btn").addClass("btn-"+bootstrapSkin);
selectStoClerkTargetByClerkId();
$('.form_date').datetimepicker({
				  //年月
			     format: 'yyyy-mm',  
			     autoclose: true,  
			     startView: 3,  
			     minView: 3,  
			     forceParse: false,  
			     language: 'zh-CN'
				
		    });
});

//初始化数据
 function selectStoClerkTargetByClerkId() {
		var url = path+"api/sys/store/selectStoClerkTargetByClerkId";
		url += "?t=" + new Date();
		$.ajax({
			type: "POST",
		    url: url,
		  	data:{store_code:store_code,clerk_id:clerk_id,token:securityContext.token},
		    success: function(data){
				if (data.code == "S") {
				$("#SalesTargetTableInfo").bootstrapTable("load", JSON.parse(data.data));
				} else {
					result = false;
					$.growl.error({
	 			       	title: "提示信息",
	 			       	message:"数据加载失败！" + "<br><br>" + data.data,
	 		       });
				}
		    }
		});
   

  };
  
function operateFormatter(value, row, index) {
             return [
                 '<a type="button" class="delBtn" style="margin-right:15px;"><i class="glyphicon glyphicon-remove"></i>删除</a>',
             ].join('');
         }
         
window.operateEvents = {
             'click .delBtn': function (e, value, row, index) {
                	deleteClerkInfo(row.clerk_id,row.store_code,row.month_date) ;
                 },
         }; 
//删除定义的销售目标
 function deleteClerkInfo(clerk_id,store_code,month_date) {
		var url = path+"api/sys/store/deleteStoClerkTarget";
		url += "?t=" + new Date();
		$.ajax({
			type: "POST",
		    url: url,
		  	data:{store_code:store_code,clerk_id:clerk_id,month_date:month_date,token:securityContext.token},
		    success: function(data){
				if (data.code == "S") {
				$.growl.notice({
	 			       	title: "提示信息",
	 			       	message:"删除成功！",
	 		       });
	 		       selectStoClerkTargetByClerkId();
				} else {
					result = false;
					$.growl.error({
	 			       	title: "提示信息",
	 			       	message:"删除失败！" + "<br><br>" + data.data,
	 		       });
				}
		    }
		});
   

  };
//编辑某个量体师某个月销售目标
 function updateStoClerk() {
 if($("#month_date").val() && $("#sell_target").val()){
		var url = path+"api/sys/store/updateStoClerk";
		url += "?t=" + new Date();
		url+="&token="+securityContext.token;
		var sct= new StoClerkTarget();
		sct.store_code=store_code;
		sct.clerk_id=clerk_id;
		sct.month_date=$("#month_date").val();
		sct.sell_target=$("#sell_target").val();
		sct.created_by=securityContext.user_id;
		sct.last_update_by=securityContext.user_id;
		
		$.ajax({
			type: "POST",
		    url: url,
		  	contentType: 'application/json',
 		    data:JSON.stringify(sct),
		    success: function(data){
				if (data.code == "S") {
				$.growl.notice({
	 			       	title: "提示信息",
	 			       	message:"保存成功！",
	 		       });
	 		       selectStoClerkTargetByClerkId();
				} else {
					result = false;
					$.growl.error({
	 			       	title: "提示信息",
	 			       	message:"保存失败！" + "<br><br>" + data.data,
	 		       });
				}
		    }
		});
   
}
  };

</script>