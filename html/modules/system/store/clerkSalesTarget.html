<script type="text/javascript">
       if(sessionStorage.getItem('securityContext')==null){
         window.location.href="/APPLETPC/login.html";
        }
        var securityContext = JSON.parse(sessionStorage.getItem('securityContext'));
        var path = sessionStorage.getItem('path');

          
</script>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>量体师销售目标</title>

	<link type="text/css" rel="stylesheet" href="/APPLETPC/css/common/common.css">
	<script type="text/javascript" src="/APPLETPC/js/common/common.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/common/util.js"></script>
	<script type="text/javascript"src="/APPLETPC/js/jquery/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="/APPLETPC/js/json/json2.js"></script>
    <link type="text/css" rel="stylesheet" href="/APPLETPC/js/bootstrap/css/bootstrap.css">
    <script type="text/javascript" src="/APPLETPC/js/bootstrap/js/bootstrap.js"></script>
     <script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-box/js/bootbox.min.js"></script>
	<link rel="stylesheet" href="/APPLETPC/js/plugins/jquery-chosen/css/chosen.css" type="text/css"></link>
	<script type="text/javascript" src="/APPLETPC/js/plugins/jquery-chosen/js/chosen.jquery.js"></script>
	<script type="text/javascript" src="/SPMTMWEB/js/plugins/jquery-growl/js/jquery.growl.js"></script>
	<link rel="stylesheet" href="/SPMTMWEB/js/plugins/jquery-growl/css/jquery.growl.css" type="text/css"></link>
<!-- bootstrap-table -->
<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-table/css/bootstrap-table.css">
<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/js/bootstrap-table-500.js"></script>
<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/local/bootstrap-table-zh-CN.js"></script>
<style>
label{font-weight: 600;
font-size: 12px;}

</style>
</head>

<body style="font-size:12px;">
<div id="view">
		<div style="margin:5px 10px">
			<div  style="float: left;margin-right:5px;">
				<label class="control-label" style="margin:5px;padding:0px;float: left">门店</label>
				<select id="store_code"  style="width:300px;height:30px"name="store_code" class="dept_select dimension_coding" >
				</select>
			</div>
				<button  class="btn  btn-sm" onclick="getClerkListByStoreCode();" style="margin-left: 10px">
					<i class="glyphicon glyphicon-search"></i>&nbsp;查询
				</button>
<!-- 				<button  class="btn  btn-sm" onclick="exportExcle();" style="margin-left: 10px"> -->
<!-- 					<i class="glyphicon glyphicon-share-alt"></i>&nbsp;导出 -->
<!-- 				</button> -->
		</div>
	<table id="SalesTargetTable"  
		class="table table-condensed "
			data-toggle="table" 
		    data-undefined-text=""
            data-icon-size="sm"
            data-pagination="true"
            data-page-size="10"
            data-page-list="[10,15,20,25,30]"
            data-striped="true"
		    >
			<thead >
				<tr >
					<th data-halign="center"  	 data-align="center" data-formatter="indexNuber" >序号</th>
					<th data-field="clerk_id" 	 data-halign="center" data-align="center" >量体师证号</th>
					<th data-field="clerk_name"	 data-halign="center" data-align="center"   >量体师名称</th>
					<th data-field="clerk_tel" 	 data-halign="center" data-align="center"  >量体师电话</th>
					<th data-field="create_date" data-halign="center" data-align="center" data-events="operateEvents" data-formatter="operateFormatter">操作</th>
					
				</tr>
			</thead>
		</table>
 </div>
</body>
</html>

<script type="text/javascript">

document.onkeydown = function(event) {
	var e = event || window.event || arguments.callee.caller.arguments[0];
	if(e && e.keyCode == 13) { // Enter
		getClerkListByStoreCode();
	}
};
$(document).ready(function() {
$(".btn").addClass("btn-"+bootstrapSkin);
initStoreList();
});

//初始化数据
 function getClerkListByStoreCode() {
		var url = path+"api/sys/store/getClerkListByStoreCode";
		url += "?t=" + new Date();
		$.ajax({
			type: "POST",
		    url: url,
		  	data:{store_code:$("#store_code").val(),token:securityContext.token},
		    success: function(data){
				if (data.code == "S") {
				$("#SalesTargetTable").bootstrapTable("load", JSON.parse(data.result_info));
				} else {
					result = false;
					$.growl.error({
	 			       	title: "提示信息",
	 			       	message:"数据加载失败！" + "<br><br>" + data.result_info,
	 		       });
				}
		    }
		});
   

  };
  
function operateFormatter(value, row, index) {
             return [
                 '<a type="button" class="checkBtn editBtn" style="margin-right:15px;"><i class="glyphicon glyphicon-eye-open"></i>编辑</a>',
             ].join('');
         }
         
window.operateEvents = {
             'click .editBtn': function (e, value, row, index) {
                	viewClerkInfo(row.clerk_id,row.store_code) ;
                 },
         }; 
 function viewClerkInfo(clerk_id,store_code) {
	
	var url="/APPLETPC/html/modules/system/store/clerkSalesTargetEdit.html";
	
	sessionStorage.setItem('clerk_id', clerk_id);	
	sessionStorage.setItem('store_code', store_code);	
	var ClerkFrame = '<iframe id="ClerkFrame" class="my-modal-iframe" width="100%" height="400px" src="' + url + '"></iframe>';
	window.parent.bootbox.dialog({
		title: "量体师销售目标编辑",
		message: ClerkFrame,
		size: "large",
		buttons: {
			saveType: {
	      		label: "保存",
	      		className: "btn-"+bootstrapSkin,
	      		callback: function() {
	      			var result = window.top.document.getElementById("ClerkFrame").contentWindow.doEditClerk();
	      			return result;
	      		}
			},
			cancelType: {
	      		label: "取消",
	      		className: "btn-default",
	      		callback: function() {
	      			return true;
	      		}
			}
		}
	});
}  

	//初始化门店信息
	function initStoreList() {
		var url = path + "api/collectMoney/getStoreCodeList";
		$.ajax({
			type : "POST",
			url : url,
			headers:{"token":securityContext.token},
			success : function(data) {
				if (data.code == "S") {
					$("#store_code").html("");
					$.each(JSON.parse(data.result_info), function(index, d) {
                       var option='<option value="' + d.code + '">'+ d.name + '</option>';
					$("#store_code").append(option);  
					});
					$('#store_code').chosen();
				} else {
					$.growl.error({
	 			       	title: "提示信息",
	 			       	message:"数据加载失败！" + "<br><br>" + data.result_info,
	 		       });
				}
			}
		});
	};
// 	function exportExcle(){
// 	$("#SalesTargetTable").table2excel({
// 					exclude: ".noExl",
// 					name: "量体师销售目标报表",
// 					filename: "量体师销售目标报表" +getCurrentDate(),
// 					fileext: ".xlsx",
// 					exclude_img: true,
// 					exclude_links: true,
// 					exclude_inputs: true
// 	});
// 	}
</script>