<script type="text/javascript">
	if (sessionStorage.getItem('securityContext') == null) {
		window.location.href = "/APPLETPC/login.html";
	}
	var securityContext = JSON.parse(sessionStorage.getItem('securityContext'));
	var bootstrapSkin = securityContext.bootstrapSkin;
	var path = sessionStorage.getItem('path');
	var order = sessionStorage.getItem('order');
	var materialCode = sessionStorage.getItem('materialCode');
	var pricing = sessionStorage.getItem('pricing');
	
	
</script>
<!DOCTYPE html>
<html>
<head>
	<title>编辑物料编码</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/css/common/common.css">
	<script type="text/javascript" src="/APPLETPC/js/common/common.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/common/util.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/jquery/jquery-2.2.3.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/json/json2.js"></script>
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/bootstrap/css/bootstrap.css">
	<script type="text/javascript" src="/APPLETPC/js/bootstrap/js/bootstrap.js"></script>
	<script type="text/javascript" src="../../../../../js/json/model/SysCuringStylesPrice.js"></script>
	<script type='text/javascript' src='/APPLETPC/js/json/model/SysLog.js'></script>
	<!-- jquery-validator -->
	<script type="text/javascript" src="/APPLETPC/js/plugins/jquery-validate/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/jquery-validate/jquery.validate.plu.js"></script>
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-datetime/css/bootstrap-datetimepicker.min.css">
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-datetime/js/bootstrap-datetimepicker.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-datetime/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
	<link rel="stylesheet" href="../../../../../js/plugins/jquery-chosen/css/chosen.css" type="text/css"></link>
	<script type="text/javascript" src="../../../../../js/plugins/jquery-chosen/js/chosen.jquery.js"></script>
	<script type="text/javascript" src="../../../../../js/plugins/layer/layer.js"></script>
	<script type="text/javascript" src="../../../../../js/json/model/SoPurchaseCode.js"></script>
	
	
</head>
<body class="my-body-content">
	<form id="typeAddForm" name="typeAddForm" class="my-form-content">
		<input  id="id" name="id" type="hidden" >
		<input  id="category" name="category"type="hidden" >
		<table class="my-form-table-content">
			<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;">定价规范</label>
						</td>
						<td class="my-form-table-td-content" style="width:100px">
							<input  id="pricing" name="pricing" type="text"  class="form-control input-sm"  style="width:180px;padding:5px;float:left;" readonly="readonly"></select> 
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;">物料编码</label>
						</td>
						<td class="my-form-table-td-content">
							<input  id="code" name="code" type="text"  class="form-control input-sm"  style="width:180px;padding:5px;float:left;"></select> 
							
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;" >物料名称</label>
						</td>
						<td class="my-form-table-td-content">
							<input  id="name" name="name" type="text"  class="form-control input-sm"  style="width:180px;padding:5px;float:left;"></select> 
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;">规格型号</label>
						</td>
						<td class="my-form-table-td-content">
							<input  id="model" name="model" type="text"  class="form-control input-sm"  style="width:180px;padding:5px;float:left;" readonly="readonly"></select> 
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;">批次号</label>
						</td>
						<td class="my-form-table-td-content" style="width:180px;padding:0px;float:left;">
							<input  id="order_line_id" name="order_line_id" type="text"  class="form-control input-sm"  style="width:180px;padding:5px;float:left;"></select> 
							
						</td>
					</tr>
					<tr>
						<td class="my-form-table-td-label">
							<label class="control-label" style="margin:5px;padding:0px;">单价</label>
						</td>
						<td class="my-form-table-td-content">
							<input  id="price" name="price" type="text"  onkeyup="totalPracticalPrice(this)"  min="0" required="required" class="form-control input-sm"  style="width:180px;padding:5px;float:left;"></select> 
						</td>
					</tr>
		</table>
	</form>
</body>
</html>

<script type="text/javascript">
	
	$(document).ready(function() {
		initFrom();			//初始化表单
	});

	// 初始化表单
	function initFrom() {
		var url = path + "api/sys/materialCodePrice/getById?currentTime=" + new Date();
		$.ajax({
			type : "get",
			url : url,
			data:{"token":securityContext.token,"materialCode":materialCode,"order":order,"pricing":pricing},
			success : function(data) {
				if (data.result_code == "Y") {
					var SoPurchaseCode = JSON.parse(data.result_info);
					dwr.util.setValues(SoPurchaseCode);
				} else if (data.result_code == "N") {
					layer.msg("数据加载失败！" +data.result_info)
				}
			}
		});
	}


//编辑
function toEditMaterialCode() {
		var result = false ;
		var cc = new SoPurchaseCode();	
		dwr.util.getValues(cc);
		cc.tempCode=materialCode;
		cc.tempOrder=order;
		cc.last_updated_by=securityContext.user_id;
		var url = path+"api/sys/materialCodePrice/update?t=" + new Date()+"&token="+securityContext.token;
		$.ajax({
			type:"POST",
			url:url,
			contentType: 'application/json',
		 	data:JSON.stringify(cc),
			async:false,
			success: function(data) {
					if (data.result_code == "Y") {
					 layer.msg("保存成功");
					 result = true;
					} else if (data.result_code == "N") {
						result = false;
						layer.msg("保存失败"+ data.result_info);
					}
			    }
			});
		return result;
}

//验证数字
function totalPracticalPrice(obj){
	if(obj){
	obj.value = obj.value.replace(/[^\d.]/g,""); // 清除"数字"和"."以外的字符
	obj.value = obj.value.replace(/^\./g,""); // 验证第一个字符是数字
	obj.value = obj.value.replace(/\.{2,}/g,"."); // 只保留第一个, 清除多余的
	obj.value = obj.value.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
	//obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3'); // 只能输入两个小数
	}
}
</script>