<script type="text/javascript">
	if (sessionStorage.getItem('securityContext') == null) {
		window.location.href = "/APPLETPC/login.html";
	}
	var securityContext = JSON.parse(sessionStorage.getItem('securityContext'));

	var path = sessionStorage.getItem('path');
	var member_id = sessionStorage.getItem("member_id");
</script>
<!DOCTYPE html>
<html>
<head>
	<title>会员</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/css/common/common.css">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/bootstrap/css/bootstrap.css">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-table/css/bootstrap-table.css">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-table/extensions/editable/bootstrap-editable.css">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-datetime/css/bootstrap-datetimepicker.min.css">
	<link rel="stylesheet" href="../../../../js/plugins/imgPlugin/css/common.css" type="text/css"></link>
	<link rel="stylesheet" href="../../../../js/plugins/imgPlugin/css/index.css" type="text/css"></link>
	<link rel="stylesheet" href="../../../../js/plugins/imgPlugin/imgbox/imgbox.css" type="text/css"></link>
	<link rel="stylesheet" href="../../../../css/member/member.css" type="text/css"></link>
	<script type="text/javascript" src="/APPLETPC/js/common/common.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/common/util.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/jquery/jquery-2.2.3.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/json/json2.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/bootstrap/js/bootstrap.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-datetime/js/bootstrap-datetimepicker.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-datetime/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
	<script type="text/javascript" src="../../../../js/plugins/bootstrap-table/js/bootstrap-table-500.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/local/bootstrap-table-zh-CN.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/extensions/editable/bootstrap-table-editable.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/extensions/editable/bootstrap-editable1.js"></script>
	<script type="text/javascript" src="../../../../js/plugins/layer/layer.js"></script>
	<script type="text/javascript" src="../../../../js/json/model/MbrMemberReturnVisit.js"></script>
	<script type="text/javascript" src="../../../../js/json/model/MbrMember.js"></script>
	<script type="text/javascript" src="../../../../js/json/model/SoOrderSiebelCustomer.js"></script>

</head>
<body class="my-body-content" >
	<!-- 顶部标签页切换按钮start -->
	<div class="buttonDiv my-form-content">
		<button onclick="button(this)" id="button1" style="background: #96bef1;">客户资料</button>
		<button onclick="button(this)" id="button2">客户照片</button>
		<button onclick="button(this)" id="button3">回访记录</button>
		<button onclick="button(this)" id="button4">消费记录</button>
	</div>
	<!-- 顶部标签页切换按钮end -->
	<!-- 模块1（客户资料）start -->
	<div class="iframeDiv" id="iframeDiv1" >
		<form id="OutStockForm" name="OutStockForm" class="my-form-content">
			<input type="hidden" id="member_source" name="member_source">
			<input type="hidden" id="member_source_id" name="member_source_id">
			<input type="hidden" id="delete_status" name="delete_status">
			<input type="hidden" id="create_date" name="create_date">
			<table class="my-form-table-content">
				<tr>
					<td class="my-form-table-td-content" style="width:480px;">
						<label class="control-label" style="margin:5px;padding:0px;">
							手机号
						</label>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">
							会员等级
						</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:290px;">
						<input id="mobilephone" name="mobilephone" type="text" class="form-control input-sm" style="width:270px;padding:5px;float:left;" />
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<select type="text" id="member_level" name="member_level"  class="form-control input-sm"  style="width:270px;padding:5px;float:left; border-radius: 3px;"></select>
						</div>
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:400px;">
						<label class="control-label" style="margin:5px;padding:0px;">
							姓名
						</label>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">
							会员类型
						</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<input type="text" id="real_name" class="form-control input-sm" name="real_name" style="width:270px;padding:5px;float:left; border-radius: 3px;">
						</div>
					</td>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<select type="text" id="member_type" class="form-control input-sm" name="member_type" style="width:270px;padding:5px;float:left; border-radius: 3px;"></select>
						</div>
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:400px;">
						<label class="control-label" style="margin:5px;padding:0px;">用户名</label>
					</td>
					<td class="my-form-table-td-content" style="width:400px;">
						<label class="control-label" style="margin:5px;padding:0px;">来源渠道 </label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="user_name" name="user_name" type="text" class="form-control input-sm" style="width:270px;float:left;">
					</td>
					<td class="my-form-table-td-content" style="width:280px;">
						<select type="text" id="sources" class="form-control input-sm" name="sources" 
								style="width:270px;padding:5px;float:left; border-radius: 3px;">
							</select>
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:400px;">
						<label class="control-label" style="margin:5px;padding:0px;"> 性别 </label>
					</td>
					<td class="my-form-table-td-content" style="width:400px;">
						<label class="control-label" style="margin:5px;padding:0px;">积分</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<select id="sex" name="sex" type="text" class="form-control input-sm" style="width:270px;float:left;">
							<option>男</option>
							<option>女</option>
						</select>
					</td>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="integral" name="integral" type="text" class="form-control input-sm" style="width:270px;float:left;" >
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">邮箱</label></td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">固话</label></td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="email" name="email" type="text" class="form-control input-sm" style="width:270px;float:left;"></td>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<input type="text" id="telephone" class="form-control input-sm" name="telephone" style="width:270px;padding:5px;float:left; border-radius: 3px;">
						</div>
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">身高 </label>
					</td>
	
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">体重</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="height" name="height" type="text" class="form-control input-sm" style="width:270px;float:left;"></td>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<input type="text" id="weight" class="form-control input-sm" name="weight" class="form-control input-sm" style="width:270px;padding:5px;float:left; border-radius: 3px;">
						</div>
					</td>
				</tr>
				
				
				
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">年龄</label>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">肤色</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="age" name="age" type="text" class="form-control input-sm" style="width:270px;float:left;">
					</td>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<input type="text" id="skin_colar" class="form-control input-sm" name="skin_color"  style="width:270px;padding:5px;float:left; border-radius: 3px;">
						</div>
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">职业</label>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">爱好</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="careers" name="careers" type="text" class="form-control input-sm" style="width:270px;float:left;"></td>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<input type="text" id="hobbies" class="form-control input-sm" name="hobbies" style="width:270px;padding:5px;float:left; border-radius: 3px;">
						</div>
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">生日</label>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">结婚纪念日</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="birthdays" name="birthdays" type="text" class="form-control input-sm" style="width:270px;float:left;">
					</td>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<input type="text" id="wedding_anniversaries" class="form-control input-sm" name="wedding_anniversaries" class="form-control input-sm" 
								 	style="width:270px;padding:5px;float:left; border-radius: 3px;">
						</div>
					</td>
				</tr>
		
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">微信</label>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">qq</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<input id="wechat" name="wechat" type="text" class="form-control input-sm" style="width:270px;float:left;"></td>
					<td class="my-form-table-td-content" style="width:290px;">
						<div class="input-group">
							<input type="text" id="qq" class="form-control input-sm" name="qq" class="form-control input-sm" style="width:270px;padding:5px;float:left; border-radius: 3px;">
						</div>
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">省份</label></td>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">城市</label></td>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<select id="province" name="province" class="form-control input-sm" onchange="initCity()" style="width:270px;float:left;"></select> 
					<td class="my-form-table-td-content" style="width:290px;">
						<select id="city" name="city" class="form-control input-sm"onchange="initCounty()" style="width:270px;padding:5px;float:left; border-radius: 3px;"></select> 
	
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">区/县</label></td>
					</td>
					<td class="my-form-table-td-content" style="width:350px;">
						<label class="control-label" style="margin:5px;padding:0px;">街道</label></td>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" style="width:280px;">
						<select id="county" name="county" class="form-control input-sm" style="width:270px;float:left;"></select> 
					<td class="my-form-table-td-content" style="width:290px;">
						<input id="address" name="address" type="text" class="form-control input-sm" style="width:270px;padding:5px;float:left; border-radius: 3px;">
					</td>
				</tr>
				
				<tr>
					<td class="my-form-table-td-content">
						<label class="control-label" style="margin:5px;padding:0px;">备注</label>
					</td>
				</tr>
				<tr>
					<td class="my-form-table-td-content" colspan="2">
						<input id="description" name="description" type="text" class="form-control input-sm" style="width:670px;padding:5px;float:left;">
					</td>
				</tr>
			</table>
		</form>
	</div>
	<!-- 模块1（客户资料）end -->
	
	<!-- 模块2（客户照片）start -->
	<div class="iframeDiv" id="iframeDiv2"  style="display: none">
		<form id="from2" name="from2" class="my-form-content">
			<div class="img-box full">
				<section class="img-section">
					<p class="up-p" style="margin-left:20px;">会员照片</p>
					<div class="z_photo upimg-div clear" id="fileDiv">
			               	  <section class="z_file fl">
		               	  		<img src="../../../js/plugins/imgPlugin/img/add.png" class="add-img" id="addImg" style="display: none">
			               	 	<input type="file" name="file" id="file" class="file" value="" accept="image/jpg,image/jpeg,image/png,image/bmp" multiple />
			               	 </section>
			         </div>
				 </section>
			</div>
	        <aside class="mask works-mask">
				<div class="mask-content">
					<p class="del-p">确定删会员照片？</p>
					<p class="check-p"><span class="del-com wsdel-ok">确定</span><span class="wsdel-no">取消</span></p>
				</div>
			</aside>
		</form>
	</div>
	<!-- 模块2（客户照片）end -->
	
	<!-- 模块3（回访记录）start -->
	<div class="iframeDiv iframeDiv3 " id="iframeDiv3" style="display: none">
        <form id="from3" name="from3" class="my-form-content" style="position: relative;">
            <!-- 回访记录顶部【查看】按钮 -->
            <div class="visitButtonDiv my-form-content" id="visitButtonDiv">
                <a id="visitAddButton" class="btn  btn-sm" onclick="showVisit();"> 查 看  </a>
                
            </div>
            
            <!-- 回访记录列表详细 -->
            <div class="visitTableDiv">
                <table id="visitTable"  class="table table-condensed " data-toggle="table" data-pagination="true" data-toolbar="visitButtonDiv" data-page-size="10" 
               		data-page-list="[10,15,30,50]"  data-search="true" >
                    <thead>
                        <tr>
                            <th data-field="member_phone_no" data-halign="center" data-align="center">手机号</th>
                            <th data-field="order_no" data-halign="center" data-align="center">  订单号  </th>
                            <th data-field="visit_people" data-halign="center" data-align="center">回访人</th>
                            <th data-field="visit_phone_no" data-halign="center" data-align="center">回访手机号</th>
                            <th data-field="visit_date" data-halign="center" data-align="center">回访时间</th>
                            <th data-field="visit_remarks" data-halign="center" data-align="center" data-order="desc">回访备注</th>
                        </tr>
                    </thead>
                </table>
            </div>
            
            <!-- 被隐藏的新增回访记录div,当点击新增时显示 。内部保存是新增一条而后隐藏，取消则直接隐藏-->
            <section id="addVisitSection" class="opacityDiv" style="display: none">
                <!-- 阴影遮罩层，长宽为100%，覆盖整个ifream -->
                <div class="lightbox"></div>
                <!-- 新增回访记录table -->
                <div class="alertPage addVisitTable">
                    <!-- 新增字段 -->
                    <form id="addVisitFrom" name="addVisitFrom" class="my-form-content">
                        <table class="my-form-table-content" style="margin: 44px auto;">
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;">会员名称</label>
                                </td>
                                <td class="my-form-table-td-content" style="width:100px">
                                    <input  id="attribute10" name="attribute10" type="text" class="form-control input-sm"  style="width:180px;padding:5px;float:left;"> </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >会员手机号</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="member_phone_no" name="member_phone_no" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"> </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >订单号</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="order_no" name="order_no" type="text" class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >回访人</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="visit_people" name="visit_people" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  required="required"> </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >回访手机号</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="visit_phone_no" name="visit_phone_no" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  required="required"> </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >文字记录</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                	<textarea id="visit_text" name="visit_text" class="form-control" rows="3"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >回访备注</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                	 <textarea  id="visit_remarks" name="visit_remarks"  class="form-control" rows="3" > </textarea>
                                	
                                </td>
                            </tr>
                        </table>
                        </tr>
                    </form>
                    <!-- 底部【保存】【取消】按钮 -->
                    <div class="visitButtonDiv my-form-content" id="visitButtonDiv">
                        <a id="visitEdit" class="btn  btn-sm" onclick="hideVisit();"> 关 闭 </a>
                    </div>
                </div>
            </section>
        </form>
    </div>
    <!-- 模块3（回访记录）end -->
	
	<!-- 模块4（消费记录）start -->
	<div class="iframeDiv" id="iframeDiv4" style="display: none">
        <form id="from4" name="from4" class="my-form-content">
        
        	<div class="orderButtonDiv my-form-content" id="orderButtonDiv" >
                <a id="orderShowButton" class="btn  btn-sm" style="display: none"onclick="showSiebelOrder();" style="display: none"> 查看  </a>
            </div>
            
            <!-- 回访记录列表详细 start-->
            <div class="orderTableDiv">
                <table id="orderTable"  class="table table-condensed " data-toggle="table" data-pagination="true" data-toolbar="orderButtonDiv" data-page-size="10" 
               		data-page-list="[10,15,30,50]"  data-search="true" >
                    <thead>
                        <tr>
                            <th data-field="order_header_id" data-halign="center" data-align="center">总单号</th>
                            <th data-field="customer_name" data-halign="center" data-align="center">姓名</th>
                            <th data-field="customer_tel" data-halign="center" data-align="center">手机号</th>
                            <th data-field="create_date" data-halign="center" data-align="center">下单时间</th>
                            <th data-field="sale_amount" data-halign="center" data-align="center">订单价格</th>
                            <th data-field="sto_performance" data-halign="center" data-align="center" data-order="desc">支付价格</th>
                            <th data-field="clerk_name" data-halign="center" data-align="center" data-order="desc">门店/量体师</th>
                            <th data-halign="center" data-align="center" data-events="operateEvents" data-formatter="operateFormatter">操作</th>
                        </tr>
                    </thead>
                </table>
            </div>
            
          	<!-- 被隐藏的消费记录div,当双击行时显示 。内部关闭按钮隐藏此div-->  
            <section id="showOrderSection" class="showOrderSection opacityDiv" style="display: none">
                <!-- 阴影遮罩层，长宽为100%，覆盖整个ifream -->
                <div class="lightbox"></div>
                <!-- 消费记录详情table 弹出高亮区域 -->
                <div class="alertPage showOrderTable" style="top: 4%;height: 670px;">
                    <!-- 新增字段 -->
                    <form id="showOrderFrom" name="showOrderFrom" class="my-form-content">
                        <table class="my-form-table-content" style="margin: 44px auto;">
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;">会员名称</label>
                                </td>
                                <td class="my-form-table-td-content" style="width:100px">
                                    <input  id="member_name" name="member_name" type="text" class="form-control input-sm"  style="width:180px;padding:5px;float:left;" > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >手机号</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="member_phone" name="member_phone" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;" > </select> 
                                </td>
                            </tr>
                            
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >订单号</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="order_no" name="order_no" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >订单来源</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="order_source" name="order_source" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >下单时间</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="order_create_time" name="order_create_time" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >订单状态</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="order_status" name="order_status" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;" > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >订单价格</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="order_price" name="order_price" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;" > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >支付价格</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="pay_price" name="pay_price" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >商品名称</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="good_name" name="good_name" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >商品品类</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="good_categroy" name="good_categroy" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >面料号</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="lining_no" name="lining_no" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >店员/量体师</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="measure_name" name="measure_name" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                            <tr>
                                <td class="my-form-table-td-label">
                                    <label class="control-label" style="margin:5px;padding:0px;" >服务手机号</label>
                                </td>    
                                <td class="my-form-table-td-content">
                                    <input  id="measure_phone" name="measure_phone" type="text"   class="form-control input-sm"  style="width:180px;padding:5px;float:left;"  > </select> 
                                </td>
                            </tr>
                        </table>
                        </tr>
                    </form>
                    <!-- 底部【关 闭】按钮 -->
                    <div class="orderButtonDiv my-form-content" >
                        <a  class="btn  btn-sm" onclick="hideOrder();"> 关闭 </a>
                    </div>
                </div>
            </section>
            
        </form>
    </div>    
    <!-- 模块4（消费记录）end -->
</body>
    <!--  此js要放到body元素后面，只有在body后，此js才可以调用其他js内的方法 -->
	<script type="text/javascript" src="../../../js/plugins/imgPlugin/js/imgPlugin.js"></script>

</html>

<script type="text/javascript">
	var tempMemberId;		//临时会员id
	var tempMemberName;		//临时会员名称
	var tempMemberPhone;	//临时会员手机号
	var validator;			//form验证
	var visitRowId = false;	//回访记录列表行id
	var orderRowId = false  //消费记录列表行id
	
	$(document).ready(function() {
		initProvince();			//初始化省份/城市/区
		initTypeList();			//初始化会员等级
		initmembertype();		//初始化会员类型
		initmemberSources();	//初始化客户来源渠道
		getInventory();			//回显页面数据
		initVisit();            //初始化会员回访记录
		initSiebelOrder();		//初始化siebel C客户订单信息
		
		//设置页面表单禁用，设置input灰色背景色
		for(i=0;i<$("#iframeDiv1 .input-sm").length;i++){
			$("#iframeDiv1 .input-sm")[i].disabled=true;
			$("#iframeDiv1 .input-sm")[i].style.background="#EEEEEE"
		}
	})

	function operateFormatter(value, row, index) {
		return [
				'<a type="button" class="deleteBtn" style="margin-right:15px;"><i class="glyphicon glyphicon-remove"></i>删除</a>', ].join('');
		}

	window.operateEvents = {
		'click .deleteBtn' : function(e, value, row, index) {
			delMaterial(row);
		},
	};
	
	function getInventory() {
		var url = path + "/app/system/member/getMemberInfoById";
		url += "?t=" + new Date();
		$.ajax({
			type : "POST",
			url : url,
			async : false,
			data : {
				"member_id" : member_id,
				"Authorization" : securityContext.Authorization
			},
			success : function(data) {
				if (data.code == "S") {
					recordLog("O","APPLETPC","获取会员详情成功",securityContext.user_id);
					var ra = data.data;
					initCityLinkage(ra.province?"":ra.province);
					initCountyLinkage(ra.city?"":ra.city);
					dwr.util.setValues(ra);
					tempMemberName = ra.real_name;
                    tempMemberPhone = ra.mobilephone;
                    tempMemberId = ra.member_id;
				} else {
					recordLog("OF","APPLETPC","获取会员详情失败",securityContext.user_id);
					result = false;
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "保存失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-success"
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	// 初始化省
	function initProvince() {
		var url = path + "app/system/store/getCtiyCountyList";
		url += "?parent_nodeCode=ROOT";
		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
					recordLog("O","APPLETPC","初始化省成功",securityContext.user_id);
					$.each(data.data, function(index, d) {
						$("#province").append(
								'<option value="' + d.nodeCode + '">'
										+ d.nodeName + '</option')
					});
				} else {
				recordLog("OF","APPLETPC","初始化省失败",securityContext.user_id);
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-success"
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	// 初始化市
	function initCity() {
		var url = path + "app/system/store/getCtiyCountyList";
		url += "?parent_nodeCode="+$("#province").val();

		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
				recordLog("O","APPLETPC","初始化市成功",securityContext.user_id);
					$("#city").html("");
					$("#county").html("");
					$.each(data.data, function(index, d) {
						$("#city").append(
								'<option value="' + d.nodeCode + '">'
										+ d.nodeName + '</option')
					});
					initCounty();
				} else {
				recordLog("OF","APPLETPC","初始化市失败",securityContext.user_id);
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-success"
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	// 初始化县
	function initCounty() {
		var url = path + "app/system/store/getCtiyCountyList";
		url += "?parentNodeCode="+$("#city").val();

		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
				recordLog("O","APPLETPC","初始化县成功",securityContext.user_id);
					$("#county").html("");
					$.each(data.data, function(index, d) {
						$("#county").append(
								'<option value="' + d.nodeCode + '">'
										+ d.nodeName + '</option')
					});
					
				} else {
				recordLog("OF","APPLETPC","初始化县失败",securityContext.user_id);
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-success"
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	// 初始化市
	function initCityLinkage(province) {
		var url = path + "app/system/store/getCtiyCountyList";
		url += "?parentNodeCode=" +province;
		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
				recordLog("O","APPLETPC","省市联动成功",securityContext.user_id);
					$("#city").html("");
					$("#county").html("");
					$.each(data.data, function(index, d) {
						$("#city").append(
								'<option value="' + d.nodeCode + '">'
										+ d.nodeName + '</option')
					});

				} else {
				recordLog("OF","APPLETPC","省市联动失败",securityContext.user_id);
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-success"
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	// 初始化县
	function initCountyLinkage(city) {
		var url = path + "app/system/store/getCtiyCountyList";
		url += "?parentNodeCode=" + city;

		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
				recordLog("O","APPLETPC","市县联动成功",securityContext.user_id);
					$("#county").html("");
					$.each(data.data, function(index, d) {
						$("#county").append(
								'<option value="' + d.nodeCode + '">'
										+ d.nodeName + '</option')
					});

				} else {
					recordLog("OF","APPLETPC","市县联动失败",securityContext.user_id);
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-success"
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	
	//初始化会员等级
	function initTypeList() {
		var url = path + "app/system/datadict/getSingleDataDictItemList";
		url += "?typeCode=member_level&enabledFlag=Y";
		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
					$("#member_level").html("");
					$.each(data.data, function(index, d) {
						$("#member_level").append( '<option value="' + d.itemCode + '">' + d.itemName + '</option')
					});
				} else {
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-default" ,
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	//初始化会员类型
	function initmembertype() {
		var url = path + "app/system/datadict/getSingleDataDictItemList";
		url += "?typeCode=member_type&enabledFlag=Y";
		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
					$("#member_type").html("");
					$.each(data.data, function(index, d) {
						$("#member_type").append( '<option value="' + d.itemCode + '">' + d.itemName + '</option')
					});
				} else {
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-default" ,
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	//初始化客户来源渠道 (参观团、散客、老客户、工装 )
	function initmemberSources() {
		var url = path + "app/system/datadict/getSingleDataDictItemList";
		url += "?typeCode=member_sources&enabledFlag=Y";
		$.ajax({
			type : "get",
			url : url,
			async : false,
			headers:{"Authorization":securityContext.Authorization},
			success : function(data) {
				if (data.code == "S") {
					$("#sources").html("");
					$.each(data.data, function(index, d) {
						$("#sources").append( '<option value="' + d.itemCode + '">' + d.itemName + '</option')
					});
				} else {
					window.parent.bootbox.dialog({
						title : "错误信息",
						message : "数据加载失败！" + "<br><br>" + data.data,
						size : "middle",
						buttons : {
							cancelType : {
								label : "确定",
								className : "btn-default" ,
								callback : function() {
									return true;
								}
							}
						}
					});
				}
			}
		});
	}
	//标签页切换
	function button(obj){
		for(var i=0;i<$(".buttonDiv button").length;i++){
			//根据顶部标签页切换按钮来切换div并修改按钮的css样式
			$(".iframeDiv")[i].style.display="none"
			$(".buttonDiv button")[i].style.background="#ccc"
			if(	$(".buttonDiv button")[i] == obj){
				$(".buttonDiv button")[i].style.background="#96bef1";
				$(".iframeDiv")[i].style.display=""
			}
		}
	}
	
	/*
  	 *下面是回访记录 ↓↓
  	 */
  	 
	//初始化回访记录
    function initVisit(){
        var url =path+"app/system/member/getVisitByMemberId?memberId="+member_id+ "&t=" + new Date();
        $.ajax({
            type: "GET",
            url: url,
            async:false,
            headers:{"Authorization":securityContext.Authorization},
            success: function(data) {
            	var json = data.data;
            	for(var i=0;i<json.length;i++){
            		if(json[i].visit_remarks.length > 8 ){
            			json[i].visit_remarks = json[i].visit_remarks.substring(0,7)+"...";
            		}
            	}
                if (data.code == "S") {
                    $("#visitTable").bootstrapTable("load", json);
                } else {
                    recordLog("OF","APPLETPC","会员回访记录初始化失败",securityContext.user_id);
                    layer.msg("初始化会员回访回访记录失败："+data.data);
                }
            }
        });
    }
    
    //回访记录鼠标事件  用于标记回访记录id
    $(document).ready(function() {
    	//单击选中行
        $("#visitTable").on('click-row.bs.table', function (e, row, $element) {
            $('.warning').removeClass('warning');
            $($element).addClass('warning');
            visitRowId = row.id;
        });
        //双击获取当前行
        $("#visitTable").on('dbl-click-row.bs.table', function (e, row, $element) {
            $('.warning').removeClass('warning');
            $($element).addClass('warning');
            visitRowId = row.id;
            showVisit("edit");//编辑回访记录
        }); 
    });
    
  //隐藏新增回访记录table
    function hideVisit(){
    	//先情况输入框内容
        var visitDate=new MbrMemberReturnVisit();
        dwr.util.setValues(visitDate);
        $("#addVisitSection").hide(300)
    }
  //显示新增回访记录table
    function showVisit(doo){
        	//先判断是否已选中行
        	if (!visitRowId) {
        		layer.msg("请选择回访记录！");
        		return;
        	}
       	    $("#addVisitSection").fadeIn(1200);
            initVisitById()	//通过id初始话单条回访记录
            $("#visitAdd").removeAttr("onclick").attr("onclick","editVisit()");
     
        
    }
    
  //初始化单条回访记录，用于编辑回访记录
    function initVisitById(){
        var url = path+"/app/system/member/getVisitById?t=" + new Date();
        $.ajax({
            type: "GET",
            url: url,
            async: false,
            data:{"id":visitRowId,"Authorization":securityContext.Authorization},
            success: function(data){
                if (data.code == "S") {
                    var ra=data.data
                    dwr.util.setValues(ra);
                } else {
                    layer.msg("初始化回访记录失败"+data.data);
            	}
            }
        });
    }
  
    /*
  	 *下面是获取sieble C客户的订单信息 ↓↓
  	 */
  	
  	//消费记录鼠标事件  用于标记回访记录id
    $(document).ready(function() {
    	//单击选中行
        $("#orderTable").on('click-row.bs.table', function (e, row, $element) {
            $('.warning').removeClass('warning');
            $($element).addClass('warning');
			orderRowId = row.order_header_id;        });
        //双击获取当前行
        $("#orderTable").on('dbl-click-row.bs.table', function (e, row, $element) {
            $('.warning').removeClass('warning');
            $($element).addClass('warning');
            orderRowId = row.order_header_id;
        }); 
    });
    
  	//初始化sieble订单信息
    function initSiebelOrder(){
    
        var url =path+"app/system/member/selectPCSPMTMOrdenByPhone?member_phone="+tempMemberPhone+ "&t=" + new Date();
        $.ajax({
            type: "GET",
            url: url,
            async:false,
            headers:{"Authorization":securityContext.Authorization},
            success: function(data) {
                //因数据库原因，将物料名称在页面上赋值
                var json = data.data;
                if (data.code == "S") {
                	for(var i=0;i<json.length;i++){
                		json[i].order_create_time = new Date(json[i].order_create_time).format("yyyy-MM-dd");
                		/* if(json[i].good_name.length > 8 ){
                 			json[i].good_name = json[i].good_name.substring(0,7)+"...";
                  		} */
                	}
                    $("#orderTable").bootstrapTable("load", json);
                } else {
                    recordLog("OF","SPMTMWEB","会员消费记录初始化失败",securityContext.member_id);
                    layer.msg("初始化会员消费记录失败："+data.data);
                }
            }        });
    }
    
	 //消费记录详情   
	function operateFormatter(value, row, index) {
	    var array = ['<a type="button" class="OrdenBtn editBtn" style="margin-right:15px;"><i class="glyphicon glyphicon-eye-open"></i>总单详情</a>',
	        '<a type="button" class="CollectMoneyBtn editBtn" style="margin-right:15px;"><i class="glyphicon glyphicon-eye-open"></i>收银单详情</a>'
	    ];
	    return array.join('');
	}
	window.operateEvents = {
	    'click .OrdenBtn ': function (e, value, row, index) {
	            viewOrderInfo(row.order_header_id);
	        },
	        'click .CollectMoneyBtn': function (e, value, row, index) {
	            viewCollectMoneyInfo(row.order_header_id);
	        },
	};
    
    //查看总单详情
 function viewOrderInfo(orderRowId) {

     var url = "/APPLETPC/html/modules/orden/MainOrdernfo.html";
     sessionStorage.setItem('order_header_id', orderRowId);
     var OrderFrame = '<iframe id="OrderFrame" class="my-modal-iframe" width="100%" height="550px" src="' + url + '"></iframe>';
     window.parent.bootbox.dialog({
         title: "收银总单详情",
         message: OrderFrame,
         size: "large"
     });
 }
 
 //查看收银详细

 function viewCollectMoneyInfo(order_header_id) {
	var url="/APPLETPC/html/modules/orden/CollectMoneyInfo.html";
	sessionStorage.setItem('order_header_id', order_header_id);	
	var OrderFrame = '<iframe id="OrderFrame" class="my-modal-iframe" width="100%" height="550px" src="' + url + '"></iframe>';
	window.parent.bootbox.dialog({
		title: "收银总单详情",
		message: OrderFrame,
		size: "large"
	});
}

	//显示消费记录详细信息
    function showSiebelOrder(){
    	if (!orderRowId) {
    		layer.msg("请选择消费记录！");
    		return;
    	}
    	 $("#showOrderSection").fadeIn(1200);
    	var url = path+"/app/system/member/getSiebleOrderByOrderNo?t=" + new Date();
        $.ajax({
            type: "GET",
            url: url,
            async: false,
            data:{"order_no":orderRowId,"Authorization":securityContext.Authorization,"member_phone":tempMemberPhone},
            success: function(data){
                if (data.code == "S") {
                    //OrderInfoRead();			//设置消费记录页面只读
                    var json=data.data;
                    json.order_create_time = new Date(json.order_create_time).format("yyyy-MM-dd  hh:mm:ss");
                    dwr.util.setValues(json);
                    document.getElementsByName("order_no")[1].value=json.order_no;
                } else {
                    layer.msg("初始化回访记录失败"+data.data);
            	}
            }
        });
    }
	
  	//隐藏新增回访记录table
    function hideOrder(){
        $("#showOrderSection").hide(300)
        orderRowId = false;
    }
    
    //设置消费记录表单只读
    function OrderInfoRead(){
    	for(var i=0;i<$(".showOrderTable .input-sm").length;i++){
    		$(".showOrderTable .input-sm")[i].readOnly = true ;
    	}
    }


	
</script>