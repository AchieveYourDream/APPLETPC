<script type="text/javascript">
	if (sessionStorage.getItem('securityContext') == null) {
		window.location.href = "/APPLETPC/login.html";
	}
	var securityContext = JSON.parse(sessionStorage.getItem('securityContext'));

	var path = sessionStorage.getItem('path');
</script>
<!DOCTYPE html>
<html>
<head>
	<title>会员列表</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/css/common/common.css">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/bootstrap/css/bootstrap.css">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-treeview/css/bootstrap-treeview.css">
	<link type="text/css" rel="stylesheet" href="/APPLETPC/js/plugins/bootstrap-table/css/bootstrap-table.css">
	<script type="text/javascript" src="/APPLETPC/js/common/common.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/common/util.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/jquery/jquery-2.2.3.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/json/json2.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/bootstrap/js/bootstrap.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-box/js/bootbox.min.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-treeview/js/bootstrap-treeview.js"></script>
	<script type='text/javascript' src='/APPLETPC/js/json/model/SysLog.js'></script>
	<script type="text/javascript" src="../../../../js/plugins/bootstrap-table/js/bootstrap-table-500.js"></script>
	<script type="text/javascript" src="/APPLETPC/js/plugins/bootstrap-table/local/bootstrap-table-zh-CN.js"></script>
	<script type="text/javascript" src="../../../../js/plugins/export/js/jquery-table2excel.min.js"></script>
	<style>
		td {
			padding: 15PX 0px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			table-layout: fixed;
			width: 90% !important;
		}
		.table-condensed {
			table-layout: fixed;
		}
		.modal-header{
		    background: #f6f6f6;
		}
	</style>
</head>
<body style="font-size:12px;">

	<div id="userToolbar">
		<button id="refreshTypeBtn" class="btn  btn-sm" onclick="redresh();">
			<i class="glyphicon glyphicon-refresh"></i>&nbsp;刷新
		</button>
		<button id="advanceSearchBtn" class="btn  btn-sm" onclick="advancedSearch();">
			<i class="glyphicon glyphicon-search"></i>&nbsp;高级搜索
		</button>
		<button id="exportExcle" class="btn  btn-sm" onclick="exportExcle();">
			<i class="glyphicon glyphicon-search"></i>&nbsp;导出
		</button>
		
	</div>
	
	<table id="memberTable" class="table table-condensed " data-toggle="table" data-toolbar="#userToolbar" data-icon-size="sm" 
	data-url="http://localhost:8080/SPMTM/app/system/member/getPCMemberListByStoreBrand" data-data-type="json" data-query-params="queryParams"
	data-pagination="true" data-side-pagination="server" data-pagination="true" data-page-size="10" data-page-list="[10,15,30,50,100,ALL]" data-undefined-text="" data-height="550">
		<thead>
			<tr>
				<th data-field="member_source" data-halign="center" data-align="center">会员来源</th>
				<th data-field="attribute9" data-halign="center" data-align="center">门店</th>
				<th data-field="real_name" data-halign="center" data-align="center">姓名</th>
				<th data-field="sex" data-halign="center" data-align="center">性别</th>
				<th data-field="mobilephone" data-halign="center" data-align="center">电话</th>
				<th data-field="price" data-halign="center" data-align="center" >消费金额</th>
				<th data-field="description" data-halign="center" data-align="center">说明</th>
			</tr>
		</thead>
	</table>
</body>
</html>

<script type="text/javascript">
	var member_id;									//会员id
	var searchCondition;							//搜索条件
	$(".btn").addClass("btn-" + bootstrapSkin);		//bootstrap表单
	
    //回访记录鼠标事件  用于标记回访记录id
    $(document).ready(function() {
    	//单击行
    	$("#memberTable").on('click-row.bs.table',
			function(e, row, $element) {
				$('.warning').removeClass('warning');
				$($element).addClass('warning');
				member_id = row.member_id;
		});
    	//双击行
		$("#memberTable").on('dbl-click-row.bs.table',
			function(e, row, $element) {
				$('.warning').removeClass('warning');
				$($element).addClass('warning');
				member_id = row.member_id;
				viewMemberInfo();//弹出【会员信息】页面
		});
    });
    
    //查询条件
	function queryParams(params) {
		return {
			offset : params.offset,			//分页：下标开始
			limit : params.limit,			//分页：显示几条
			search : searchCondition,		//搜索条件
			token : securityContext.token,	//token
			store_brand : "cotte"			//门店品牌
		};
	}
	
    //刷新表格
	function redresh() {
		$('#memberTable').bootstrapTable('refresh');
	}
	
	//弹出【会员信息】页面
	function viewMemberInfo() {
		var url = "/APPLETPC/html/modules/member/cotte/MemberInfo.html";
		sessionStorage.setItem("member_id", member_id);
		var memberInfoFrame = '<iframe id="logFrame" class="my-modal-iframe" width="100%" height="750px;"style="padding:15px" src="' + url + '"></iframe>';
		window.parent.bootbox.dialog({
			title: "会员信息",
			size: "large",
			message: memberInfoFrame,
			buttons: {
				cancelType: {
					label: "关 闭",
					className: "btn-default",
					callback: function() {
						return true
					}
				}
			}
		})
	}
	
	//高级搜索
	function advancedSearch() {
		var url = "/APPLETPC/html/modules/system/search/AdvanceSearch.html?searchCode=mbr_member";
		sessionStorage.setItem("searchCode", 'mbr_member');
		var logSearchFrame = '<iframe id="logSearchFrame" class="my-modal-iframe" width="100%" height="300px" src="' + url + '"></iframe>';
		window.top.bootbox.dialog({
			title : "高级搜索",
			message : logSearchFrame,
			size : "small",
			buttons : {
				saveType : {
					label : "确定",
					className : "btn-success"
					callback : function() {
						var sscVO = window.top.document.getElementById("logSearchFrame").contentWindow.getAdvanceSearchConditions();
						searchCondition = JSON.stringify(sscVO);
						sessionStorage.setItem("mbr_memberSearchCondition",searchCondition);
						if (sscVO) {
							$("#memberTable").bootstrapTable('refresh');
						}
						return true;
					}
				},
				cancelType : {
					label : "取消",
					className : "btn-default",
					callback : function() {
						return true;
					}
				}
			}
		});
	}
	
	//导出excel
	function exportExcle(){
		$("#memberTable").table2excel({
						exclude: ".noExl",
						name: "会员列表",
						filename: "会员列表" +getCurrentDate(),
						fileext: ".xlsx",
						exclude_img: true,
						exclude_links: true,
						exclude_inputs: true
		});
	}
</script>